{% extends "layout.html" %}

{% block title %}ServeSYNC - Staff Dashboard{% endblock %}

{% block content %}
<link rel="stylesheet" href="/path/to/styles.css">

<main class="dashboard">
  <div class="left-column">
    <section class="section staff-profile">
        <h3><i class="fas fa-user"></i> Your Profile</h3>
        <p><strong>Name:</strong> {{ session.name }}</p>
        <p><strong>Role:</strong> {{ session.role }}</p>
        
        <div class="stats-row">
          <div class="stat-box">Total Hours: <span>153</span></div>
          <div class="stat-box">Pending: <span>4</span></div>
        </div>
      </section>
    <section class="section group-overview">
      <h3><i class="fas fa-layer-group"></i> Your Groups</h3>
      <ul>
        <li>Environmental Club</li>
        <li>Peer Mentors</li>
        <li>Event Volunteers</li>
      </ul>
      <a href="/manage-groups" class="btn btn-secondary">Manage Groups</a>
    <!-- Review Modal -->
    <div id="reviewModal" class="modal review-modal">
      <div class="modal-content">
        <span class="close-btn" onclick="closeModal()">&times;</span>
        <h2>Submission Details</h2>
        <p><strong>Student:</strong> <span id="modal-student"></span></p>
        <p><strong>Activity:</strong> <span id="modal-activity"></span></p>
        <p><strong>Hours:</strong> <span id="modal-hours"></span></p>
        <p><strong>Date:</strong> <span id="modal-date"></span></p>
        <p><strong>Status:</strong> <span id="modal-status"></span></p>
        <p><strong>Group:</strong> <span id="modal-group"></span></p>
        <p><strong>Description:</strong> <span id="modal-description"></span></p>

        <div class="modal-actions">
          <form method="post" action="/approve-log" style="display:inline;">
            <input type="hidden" name="log_id" id="approve-log-id">
            <button type="submit" class="accept-btn">Approve</button>
          </form>
          <form method="post" action="/reject-log" style="display:inline;">
            <input type="hidden" name="log_id" id="reject-log-id">
            <button type="submit" class="reject-btn">Reject</button>
          </form>
        </div>
      </div>
    </div>
    </section>

    <section class="section quick-links">
      <h3><i class="fas fa-link"></i> Quick Actions</h3>
      <ul>
        <li><a href="/approve-hours">Approve Hours</a></li>
        <li><a href="/groups">Manage groups</a></li>
        <li><a href="/reports">Download Reports</a></li>
      </ul>
    </section>
  </div>

  <div class="right-column">
    <div class="welcome-header">
      <h1 style="font-size: 42px; font-weight: bold;">
        {{ greeting }}
        <br>
        <span style="font-weight: normal;">{{ session.name }}</span>
      </h1>
    </div>

    <section class="section recent-submissions">
      <h3><i class="fas fa-clock"></i> Recent Submissions</h3>
      <form method="get" action="/staff.dashboard" class="filter-form">
        <label for="status">Filter by Status:</label>
        <select name="status" id="status" onchange="this.form.submit()">
          <option value="">All</option>
          <option value="Approved" {% if request.args.get('status') == 'Approved' %}selected{% endif %}>Approved</option>
          <option value="Pending" {% if request.args.get('status') == 'Pending' %}selected{% endif %}>Pending</option>
          <option value="Rejected" {% if request.args.get('status') == 'Rejected' %}selected{% endif %}>Rejected</option>
        </select>
      </form>
      <table class="activity-table datatable">
        <thead>
          <tr>
            <th>Student</th>
            <th>Activity</th>
            <th>Hours</th>
            <th>Date</th>
            <th>Status</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody>
          {% for log in recent_submissions %}
            <tr>
              <td>{{ log.user_id }}</td>
              <td>{{ log.description }}</td>
              <td>{{ log.hours }}</td>
              <td>{{ log.formatted_date }}</td>
              <td class="{{ log.status_label|lower }}">
                {% if log.status_label == 'Approved' %}
                  <i class="fas fa-check-circle"></i>
                {% elif log.status_label == 'Pending' %}
                  <i class="fas fa-clock"></i>
                {% elif log.status_label == 'Rejected' %}
                  <i class="fas fa-times-circle"></i>
                {% else %}
                  <i class="fas fa-question-circle"></i>
                {% endif %}
                {{ log.status_label }}
              </td>
              <td>
                <a href="javascript:void(0);" 
                   class="btn btn-primary" 
                   onclick='openReviewModal({{ log | tojson | safe }})'>
                   Review
                </a>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
      <br>
      <a href="/all-submissions" class="btn btn-secondary">
        <i class="fas fa-folder-open"></i> View All Submissions
      </a>
    </section>
  </div>
</main>
<script>
  function openReviewModal(log) {
    document.getElementById('modal-student').innerText = log.user_id;
    document.getElementById('modal-activity').innerText = log.description;
    document.getElementById('modal-hours').innerText = log.hours;
    document.getElementById('modal-date').innerText = log.formatted_date;
    document.getElementById('modal-status').innerText = log.status_label;
    document.getElementById('modal-group').innerText = log.group || "N/A";
    document.getElementById('modal-description').innerText = log.description;
    document.getElementById('approve-log-id').value = log.id;
    document.getElementById('reject-log-id').value = log.id;

    document.getElementById('reviewModal').style.display = 'block';
  }

  function closeModal() {
    document.getElementById('reviewModal').style.display = 'none';
  }

  // Close modal on outside click
  window.onclick = function(event) {
    const modal = document.getElementById('reviewModal');
    if (event.target === modal) {
      modal.style.display = "none";
    }
  }
</script>
{% endblock %}
